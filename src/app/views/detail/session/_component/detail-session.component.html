<div class="tabs-container">
  <!-- Navigation verticale des onglets -->
  <div class="vertical-tabs">
    <div *ngFor="let tab of tabs; let i = index"
         class="tab-button"
         [class.active]="selectedTabIndex === i"
         [class.hidden]="!tab.visible"
         (click)="selectedTabIndex = i">
      <mat-icon class="material-symbols-outlined">{{ tab.icon }}</mat-icon>
      <div class="tab-label-container">
        <span class="tab-label">{{ tab.label }}</span>
        <mat-icon *ngIf="tab.hasError && tab.errorCount > 0"
                  class="error-indicator material-symbols-outlined"
                  [matTooltip]="tab.errorCount + ' erreur(s)'"
                  matTooltipPosition="right">
          error
        </mat-icon>
      </div>
      <span class="tab-count" *ngIf="tab.count > 0">{{ tab.count | numberFormat:0:'â‰ˆ' }}</span>
    </div>
  </div>

  <!-- Contenu des onglets -->
  <div class="tab-content">
    <!-- API -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'rest'" class="tab-panel">
      <rest-table [requests]="session.restRequests"
                  [useFilter]="true"
                  [isLoading]="isLoading"
                  (onClickRemote)="selectedRemote($event)"
                  (onClickRow)="selectedRest($event)">
      </rest-table>
    </div>

    <!-- LOCAL -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'local'" class="tab-panel">
      <local-table [requests]="session.localRequests"></local-table>
    </div>

    <!-- FTP -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'ftp'" class="tab-panel">
      <ftp-table [requests]="session.ftpRequests"
                 [useFilter]="true"
                 [isLoading]="isLoading"
                 (onClickRow)="selectedFtp($event)">
      </ftp-table>
    </div>

    <!-- SMTP -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'smtp'" class="tab-panel">
      <smtp-table [requests]="session.mailRequests"
                  [useFilter]="true"
                  [isLoading]="isLoading"
                  (onClickRow)="selectedSmtp($event)">
      </smtp-table>
    </div>

    <!-- LDAP -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'ldap'" class="tab-panel">
      <ldap-table [requests]="session.ldapRequests"
                  [useFilter]="true"
                  [isLoading]="isLoading"
                  (onClickRow)="selectedLdap($event)">
      </ldap-table>
    </div>

    <!-- BDD -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'database'" class="tab-panel">
      <database-table [requests]="session.databaseRequests"
                      [useFilter]="true"
                      [isLoading]="isLoading"
                      (onClickRow)="selectedQuery($event)">
      </database-table>
    </div>

    <!-- Actions -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'action'" class="tab-panel">
      <action-table [requests]="session['userActions']">
      </action-table>
    </div>

    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'stage'" class="tab-panel">
      <stage-table [requests]="session['httpSessionStages']">
      </stage-table>
    </div>
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'log'" class="tab-panel">
      <log-table [requests]="session.logEntries">
      </log-table>
    </div>
    <!-- Timeline -->
    <div [class.hidden]="tabs[selectedTabIndex]?.type !== 'timeline'" class="tab-panel">
      <detail-timeline [request]="completedSession"
                       [instance]="instance">
      </detail-timeline>
    </div>
  </div>
</div>