<div *ngIf="!isLoading && request" class="header-card">
  <mat-card style="width: 100vw; min-width: 100vw;"
            [ngClass]="{'success': request.status >= 200 && request.status < 300,
                        'warning': request.status >= 300 && request.status < 500,
                        'fail': request.status >= 500,
                        'unavailable': request.end && request.status == 0,
                        'in-progress': !request.end}">
    <mat-card-title>
      <label-icon [icon]="REQUEST_TYPE['rest'].icon">
        <div style="display: flex; gap: 0.5em; align-items: center;">
          {{ request.path || 'N/A' }}
          <mat-spinner *ngIf="!request.end" [diameter]="18"></mat-spinner>
        </div>
      </label-icon>
      <div class="right">
        <button mat-icon-button [disabled]="sessionParent == null"
                [ngStyle]="sessionParent == null ? {'pointer-events': 'none'}: ''" (click)="navigate($event,'parent')"
                matTooltip="Détail de l'appel parent">
          <mat-icon>move_up</mat-icon>
        </button>
      </div>
    </mat-card-title>
    <mat-card-content>
      <div class="ellipsis">
        <a class="url" [href]="getSessionUrl()" target="_blank">
          [{{ request.method }}] {{ getSessionUrl() }}
        </a>
      </div>
      <div style="display: flex; align-items: center; gap: 0.5em; color: red; font-weight: 500; margin-top: 0.5em;"
           *ngIf="exception?.type || exception?.message || request.bodyContent"
           [matTooltip]="exception?.type">
        <mat-icon class="material-symbols-outlined" style="overflow: initial !important; width: 28px; height: 28px;">
          warning
        </mat-icon>
        <div class="ellipsis">{{ exception?.message || exception?.type || request.bodyContent }}</div>
      </div>
    </mat-card-content>
    <mat-card-footer>
      <div style="display: flex; align-items: center; gap: 0.5em">
        le {{ (request.start * 1000) | date: 'dd/MM/yyyy à HH:mm:ss.SSS': 'fr' }}
      </div>
      <div class="right">
        {{ request.inDataSize || 0 }}o
        <mat-icon style="width: 20px; height: 20px; font-size: 20px;">swap_vert</mat-icon>
        {{ request.outDataSize }}o en
        <span [matTooltip]="((request.end * 1000) | date: 'dd/MM/yyyy à HH:mm:ss': 'fr')" style="font-weight: bold">
          {{{start: request.start, end: request.end} | duration }}
        </span>
      </div>
      <span class="badge"
            [ngClass]="{'success': request.status >= 200 && request.status < 300,
                        'warning': request.status >= 300 && request.status < 500,
                        'fail': request.status >= 500,
                        'unavailable': request.status == 0 && request.end,
                        'in-progress': !request.end}">
        {{ request.end ? request.status : 'En cours' }}
      </span>
    </mat-card-footer>
  </mat-card>
</div>

<app-timeline [options]="options"
              [groups]="dataGroups"
              [items]="dataItems" [displayHeader]="false">
</app-timeline>

<div *ngIf="!isLoading && !request" class="noDataMessage mat-elevation-z5" style="height: calc(100vh - 50px - 1em);">
  <h2>
    Aucun détail disponible ..
  </h2>
</div>
<div *ngIf="isLoading"
     style="width: 100%; height: calc(100vh - 50px - 1em); display: flex; flex-direction: row; align-items: center; justify-content: center; font-style: italic; gap: 0.5em">
  <mat-progress-spinner diameter="30" mode="indeterminate"></mat-progress-spinner>
  Chargement en cours...
</div>